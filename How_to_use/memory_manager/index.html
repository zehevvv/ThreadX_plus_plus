<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Memory manager - ThreadX++</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Memory manager";
        var mkdocs_page_input_path = "How_to_use\\memory_manager.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> ThreadX++
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Install</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../Install/install_st/">Install ThreadX on ST</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Install/add_threadx_plus_plus/">Add ThreadX++</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">How to use</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../introduction/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../task/">Task (Thread)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../threadx_api/">ThreadX API (Mutex, Semaphore, Queue)</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Memory manager</a>
    <ul class="current">
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Add STM32 API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../Add_stm32_api/config_printf/">Config printf</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Add_stm32_api/watchdog/">Watchdog</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Add_stm32_api/registry/">Registry</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Add_stm32_api/measure_time/">Measure time</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">ThreadX++</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>How to use &raquo;</li>
      <li>Memory manager</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="memory-manager">Memory manager</h1>
<p>This package is optionally.<br />
It's give you easy way to init the threadX pool of bytes and override the new and the delete function<br />
<strong>Note:</strong> in order todo that you will need to change the threadX configuration to use "dynamic allocation", and you also need to config the ld file to allocate the ram section for the pool, the step 2 and 3 and 4 in this tutorial is for that but work only for STM32H743, if you have different MCU you will need to figure it out yourself how to do that (again you have a lot tutorial over the internet).</p>
<p><strong>1)</strong> Go to <code>HW.h</code> file and add the define '#define MEMORY_MANAGER_ENABLE'<br />
you also need to define <code>MEMORY_MANAGER_POOL_SIZE</code> with the size of the memory pool,<br />
for example if we want pool of 64000 bytes, you will need to add next lines to <code>HW.h</code> file:</p>
<pre><code>#define MEMORY_MANAGER_ENABLE
#define MEMORY_MANAGER_POOL_SIZE        (64000)
</code></pre>
<p><strong>2)</strong> Go To file <code>app_azure_rtos.c</code> to function <code>VOID tx_application_define(VOID *first_unused_memory)</code> and move the function <code>StartThreadXPlusPlus(first_unused_memory);</code> to end of the function: <img alt="" src="../../img/Memory_manager/change_the_start_function.png" /></p>
<p><strong>3)</strong> Now you need to config the ThreadX to work with dynamic allocation,<br />
Go to project explorer and double click on the XX.ioc file (XX is the name of you project), This will open the configuration window, and the the right side of the screen select the <code>Middleware and Software Packs</code> than select <code>X-CUBE-AZURES-H7</code>, it will open two screens, In the bottom screen (<code>Configuration</code>) select the tab <code>AzureRTOS Application</code> inside the tab open the list of <code>Memory Configuration</code>, and set the field <code>Memory allocation</code> to <code>Use Dynamic Allocation</code> <img alt="" src="../../img/Memory_manager/set_dynamic_memory.png" /><br />
than save the file, <code>File-&gt;save</code></p>
<p><strong>4)</strong> Now we need to allocate space in the RAM for the memory, you need to go to project explorer of your project and go to file <code>STM32xxx_FLASH.ld</code> (the xxx will be the name of you MCU model), you need to place new block of ram that have the size of the memory pool and save the size into variable <code>__RAM_segment_used_end__</code> ,  this block should be between the block of <code>bss</code> and <code>_user_heap_check</code>.<br />
For example let assume that we want to allocate 64000 bytes, than we need to add next block:</p>
<pre><code>._threadx_heap :
{
    . = ALIGN(8);
    __RAM_segment_used_end__ = .;
    . = . + 64K;
    . = ALIGN(8);
} &gt;RAM_D1
</code></pre>
<p>and it should be between <code>bss</code> and <code>_user_heap_check</code>, so it look like that <img alt="" src="../../img/Memory_manager/ram_allocate.png" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../threadx_api/" class="btn btn-neutral float-left" title="ThreadX API (Mutex, Semaphore, Queue)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../Add_stm32_api/config_printf/" class="btn btn-neutral float-right" title="Config printf">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../threadx_api/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../Add_stm32_api/config_printf/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
