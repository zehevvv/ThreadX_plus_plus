<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Watchdog - ThreadX++</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Watchdog";
        var mkdocs_page_input_path = "Add_stm32_api\\watchdog.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> ThreadX++
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Install</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../Install/install_st/">Install ThreadX on ST</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../Install/add_threadx_plus_plus/">Add ThreadX++</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">How to use</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../How_to_use/introduction/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../How_to_use/task/">Task (Thread)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../How_to_use/threadx_api/">ThreadX API (Mutex, Semaphore, Queue)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../How_to_use/memory_manager/">Memory manager</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Add STM32 API</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../config_printf/">Config printf</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Watchdog</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#enable-the-watchdog">Enable the watchdog</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#note">note</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../registry/">Registry</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../measure_time/">Measure time</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">ThreadX++</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Add STM32 API &raquo;</li>
      <li>Watchdog</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="watchdog">Watchdog</h1>
<p>I create class of watchdog that work on <code>IWDG1</code> internal watchdog, this watchdog need to pet every amount of time that config at init, </p>
<h2 id="enable-the-watchdog">Enable the watchdog</h2>
<p><strong>1)</strong> Go to <code>HW.h</code> file and add you need to add two define:  </p>
<ul>
<li><strong>WATCHDOG_TIMEOUT_MS :</strong> The max amount of time (milliseconds) that if the watchdog not pet (reload) -&gt; the watchdog will restart the MCU,  </li>
<li><strong>WATCHDOG_PET_MS :</strong> The time between pet (reload).  </li>
</ul>
<p>Example: if we want that watchdog will reset the MCU if it not pet more than 100ms,  also we want that our watchdog service will pet the watchdog every 90ms, so the define should be like this:</p>
<pre><code>#define WATCHDOG_TIMEOUT_MS     (100)
#define WATCHDOG_PET_MS         (90)
</code></pre>
<p><strong>2)</strong> Go to file <code>TasksManager.cpp</code>, in the function <code>Tasks_manager_start()</code> add the watchdog:</p>
<pre><code>#include &quot;Watchdog.h&quot;

void Tasks_manager_start()
{
    Watchdog::Instance()-&gt;StartTask();

</code></pre>
<h3 id="note">note</h3>
<ul>
<li>The watchdog priority is should be the lowest that possible but you need to careful to not be in same or low priority of task that will take more time than define <code>WATCHDOG_TIMEOUT_MS</code></li>
<li>The watchdog must not enable when you want to debug your system and stop the run, the watchdog will kill you.</li>
<li>When you set the system to sleep, you must somehow to pet the watchdog because it work on the LSI clock and not on the main clock.</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../config_printf/" class="btn btn-neutral float-left" title="Config printf"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../registry/" class="btn btn-neutral float-right" title="Registry">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../config_printf/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../registry/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
